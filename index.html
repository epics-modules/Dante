<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Dante &#8212; EPICS Dante 1-1-4-g59993cd documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="shortcut icon" href="_static/favicon_t.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">
          EPICS Dante</a>
        <span class="navbar-text navbar-version pull-left"><b>1-1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Dante</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#system-controls">System controls</a></li>
<li><a class="reference internal" href="#configuration-parameters">Configuration parameters</a></li>
<li><a class="reference internal" href="#run-time-statistics">Run-time statistics</a></li>
<li><a class="reference internal" href="#multi-element-systems">Multi-element systems</a></li>
<li><a class="reference internal" href="#mca-mode">MCA mode</a></li>
<li><a class="reference internal" href="#mca-mapping-mode">MCA mapping mode</a></li>
<li><a class="reference internal" href="#list-mode">List mode</a></li>
<li><a class="reference internal" href="#adc-trace-waveforms">ADC trace waveforms</a></li>
<li><a class="reference internal" href="#ioc-startup-script">IOC startup script</a></li>
<li><a class="reference internal" href="#performance">Performance</a><ul>
<li><a class="reference internal" href="#dante8-free-running-mapping-mode">Dante8 free-running mapping mode</a></li>
<li><a class="reference internal" href="#dante8-externally-triggered-mapping-mode">Dante8 externally triggered mapping mode</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/index.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <section id="dante">
<h1><a class="toc-backref" href="#id4" role="doc-backlink">Dante</a><a class="headerlink" href="#dante" title="Permalink to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Mark Rivers, University of Chicago</p>
</dd>
</dl>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#dante" id="id4">Dante</a></p>
<ul>
<li><p><a class="reference internal" href="#overview" id="id5">Overview</a></p></li>
<li><p><a class="reference internal" href="#system-controls" id="id6">System controls</a></p></li>
<li><p><a class="reference internal" href="#configuration-parameters" id="id7">Configuration parameters</a></p></li>
<li><p><a class="reference internal" href="#run-time-statistics" id="id8">Run-time statistics</a></p></li>
<li><p><a class="reference internal" href="#multi-element-systems" id="id9">Multi-element systems</a></p></li>
<li><p><a class="reference internal" href="#mca-mode" id="id10">MCA mode</a></p></li>
<li><p><a class="reference internal" href="#mca-mapping-mode" id="id11">MCA mapping mode</a></p></li>
<li><p><a class="reference internal" href="#list-mode" id="id12">List mode</a></p></li>
<li><p><a class="reference internal" href="#adc-trace-waveforms" id="id13">ADC trace waveforms</a></p></li>
<li><p><a class="reference internal" href="#ioc-startup-script" id="id14">IOC startup script</a></p></li>
<li><p><a class="reference internal" href="#performance" id="id15">Performance</a></p>
<ul>
<li><p><a class="reference internal" href="#dante8-free-running-mapping-mode" id="id16">Dante8 free-running mapping mode</a></p></li>
<li><p><a class="reference internal" href="#dante8-externally-triggered-mapping-mode" id="id17">Dante8 externally triggered mapping mode</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="overview">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>This is an EPICS driver for the <a class="reference external" href="https://www.xglab.it">XGLab</a> Dante digital x-ray spectroscopy system.
The source code is in the <a class="reference external" href="https://github.com/epics-modules/dante">dante</a> repository in the Github epics-modules project.
The Dante is available in single channel (Dante1) and 8-channel (Dante8) versions.
This module is intended to work with either, though it has currently only been tested on the single-channel version.
In this document NumBoards refers to the number of enabled input channels, e.g. 1 for a Dante1, up to 8 for a
Dante8, and &gt;8 for systems with more than one Dante8 daisy-chained together.
If a channel is disabled then it is not counted in NumBoards.</p>
<p>The Dante can collect data in 3 different modes:</p>
<ul class="simple">
<li><p>Single MCA spectrum.  It acquires a single MCA spectrum on all channels.</p></li>
<li><p>MCA mapping mode.  It acquires multiple spectra in rapid succession, and it often used for making an x-ray map where there is an MCA
spectrum for each channel at each pixel.  The advance to the next pixel can come from an internal clock or an external trigger.</p></li>
<li><p>List mapping mode.  It acquires each x-ray event energy and timestamp in a list buffer.</p></li>
</ul>
<p>The Dante driver is derived from the base class <a class="reference external" href="https://areadetector.github.io/master/ADCore/NDArray.html#asynndarraydriver">asynNDArrayDriver</a>, which is part of the EPICS <a class="reference external" href="https://areadetector.github.io">areaDetector</a> package.
The allows the Dante driver to use all of the areaDetector plugins for file saving in MCA mapping and list modes,
and for other purposes. It also implements the mca interface from the EPICS <a class="reference external" href="https://github.com/epics-modules/mca">mca</a> module.
The EPICS mca record can be used to display the spectra and control the basic operation including Regions-of-Interest (ROIs).</p>
<p>The Dante driver can be used on both Windows and Linux. A Windows machine with a USB interface is required
to load new firmware.  Otherwise the module can be used from either Linux or Windows over Ethernet. The Linux library
provided can run on most Linux versions, including RHEL7/Centos7.</p>
<p>This document does not attempt to give an explanation of the principles of operation of the Dante, or a detailed explanation
of the many configuration parameters for the digital pulse processing.  The user should consult the
<a class="reference download internal" download="" href="_downloads/d7b53c618ddb4c28be0d33ad76736657/DANTE-4553%20Manual%20rev2.3.pdf"><code class="xref download docutils literal notranslate"><span class="pre">DanteManual</span></code></a> for this information.</p>
</section>
<section id="system-controls">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">System controls</a><a class="headerlink" href="#system-controls" title="Permalink to this heading">¶</a></h2>
<p>These records are in the file <code class="docutils literal notranslate"><span class="pre">dante.template</span></code>. This database is loaded once for the Dante system.  It provides
control of the system-wide settings for the system.</p>
<table class="table-bordered table-striped table-hover docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>EPICS record names</p></th>
<th class="head"><p>Record types</p></th>
<th class="head"><p>drvInfo string</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CollectMode, CollectMode_RBV</p></td>
<td><p>mbbo, mbbi</p></td>
<td><p>DanteCollectMode</p></td>
<td><p>Controls the data collection mode.
Choices are “MCA” (0), “MCA Mapping” (1) and “List” (2).</p></td>
</tr>
<tr class="row-odd"><td><p>GatingMode, GatingMode_RBV</p></td>
<td><p>mbbo, mbbi</p></td>
<td><p>DanteGatingMode</p></td>
<td><p>Controls the gating mode.
Choices are “Free running” (0), “Trig rising” (1), “Trig falling” (2), “Trig both” (3), “Gate high” (4), “Gate low” (5).</p></td>
</tr>
<tr class="row-even"><td><p>NumMCAChannels, NumMCAChannels_RBV</p></td>
<td><p>mbbo, mbbi</p></td>
<td><p>MCA_NUM_CHANNELS</p></td>
<td><p>The number of MCA channels to use.  Choices are 1024, 2048, 4096.</p></td>
</tr>
<tr class="row-odd"><td><p>PollTime, PollTime_RBV</p></td>
<td><p>ao, ai</p></td>
<td><p>DantePollTime</p></td>
<td><p>The time between polls when reading completion status, MCA mapping data, and list mode data from the driver.
0.01 second is a reasonable value that will provide good response and resource utilization.</p></td>
</tr>
<tr class="row-even"><td><p>PresetReal</p></td>
<td><p>ao</p></td>
<td><p>MCA_PRESET_REAL</p></td>
<td><p>Sets the preset real time.  Set this to 0 to count forever in MCA mode or List mode.</p></td>
</tr>
<tr class="row-odd"><td><p>EraseStart</p></td>
<td><p>bo</p></td>
<td><p>N.A.</p></td>
<td><p>Processing this record starts acquisition for all boards in the selected CollectMode.</p></td>
</tr>
<tr class="row-even"><td><p>StartAll</p></td>
<td><p>bo</p></td>
<td><p>MCA_START_ACQUIRE</p></td>
<td><p>Processing this record starts acquisition for all boards in the selected CollectMode. This record should not
be used by higher-level software, it is processed by EraseStart.</p></td>
</tr>
<tr class="row-odd"><td><p>MCAAcquireBusy</p></td>
<td><p>busy</p></td>
<td><p>N.A.</p></td>
<td><p>This record goes to 1 (“Collecting”) when EraseStart is processed. It goes back to 0 (“Done”)when 3 conditions
are satisfied. 1) MCAAcquiring is 0; 2) All MCA records have .ACQG field=0; 3)AcquireBusy from areaDetector=0.
The last condition can ensure that all plugins are done processing if WaitForPlugins is set.</p></td>
</tr>
<tr class="row-even"><td><p>MCAAcquiring</p></td>
<td><p>bi</p></td>
<td><p>MCA_ACQUIRING</p></td>
<td><p>This record is 1 when the Dante driver itself is acquiring, and 0 when it is done. This record is generally not used
by higher level software, use MCAAcquireBusy instead, since it indicates when all components are done.</p></td>
</tr>
<tr class="row-odd"><td><p>StopAll</p></td>
<td><p>bo</p></td>
<td><p>MCA_STOP_ACQUIRE</p></td>
<td><p>Processing this record stops acquisition for all boards in the selected CollectMode. This only needs to be used
to terminate acquisition before it would otherwise stop because PresetReal or NumMappingPoints have been reached.</p></td>
</tr>
<tr class="row-even"><td><p>ReadAll</p></td>
<td><p>bo</p></td>
<td><p>N.A.</p></td>
<td><p>Processing this record reads the MCA data and statistics for all boards.  This .SCAN field of this record is typically
set to periodic, i.e. “1 second”, “.1 second”, etc. to provide user feedback while acquisition is in progress.
It can be set to “Passive” and the system will still read the data once when acquisition completes.
This can be used to improve performance at very short PresetReal times.
This record is disabled when acquisition is complete to reduce unneeded resource usage.</p></td>
</tr>
<tr class="row-odd"><td><p>ReadAllOnce</p></td>
<td><p>bo</p></td>
<td><p>N.A.</p></td>
<td><p>Processing this record reads the MCA data and statistics for all boards.  This record is processed by ReadAll. It can be
manually processed to read the data even when acquisition is complete.</p></td>
</tr>
<tr class="row-even"><td><p>ElapsedReal</p></td>
<td><p>ai</p></td>
<td><p>MCA_ELAPSED_REAL</p></td>
<td><p>The elapsed real time.</p></td>
</tr>
<tr class="row-odd"><td><p>ElapsedLive</p></td>
<td><p>ai</p></td>
<td><p>MCA_ELAPSED_LIVE</p></td>
<td><p>The elapsed live time.</p></td>
</tr>
<tr class="row-even"><td><p>DeadTime</p></td>
<td><p>ai</p></td>
<td><p>DanteDeadTime</p></td>
<td><p>The cummulative deadtime.</p></td>
</tr>
<tr class="row-odd"><td><p>IDeadTime</p></td>
<td><p>ai</p></td>
<td><p>DanteIDeadTime</p></td>
<td><p>The “instantaneous” deadtime since the previous readout.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="configuration-parameters">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Configuration parameters</a><a class="headerlink" href="#configuration-parameters" title="Permalink to this heading">¶</a></h2>
<p>These records control the configuration of the digital signal processing. The readback (_RBV) values may differ slightly
from the output values because of the discrete nature of the system clocks and MCA bins.</p>
<p>These parameters are specific to a single board, and are contained in DanteN.template.</p>
<table class="table-bordered table-striped table-hover docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>EPICS record names</p></th>
<th class="head"><p>Record types</p></th>
<th class="head"><p>drvInfo string</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>EnableBoard, EnableBoard_RBV</p></td>
<td><p>bo, bi</p></td>
<td><p>DanteEnableBoard</p></td>
<td><p>Enables (1) or disables (0) a board in a Dante8.  This allows using fewer than 8 channels on a Dante8.</p></td>
</tr>
<tr class="row-odd"><td><p>InputMode, InputMode_RBV</p></td>
<td><p>mbbo, mbbi</p></td>
<td><p>DanteInputMode</p></td>
<td><p>The analog input mode. Choices are “DC_HiImp” (0), “DC_LoImp” (1). “AC_Slow” (2), and “AC_Fast” (3).</p></td>
</tr>
<tr class="row-even"><td><p>InputPolarity, InputPolarity_RBV</p></td>
<td><p>bo, bi</p></td>
<td><p>DanteInvertedInput</p></td>
<td><p>The pre-amp output polarity. Choices are “Pos.” (0) and “Neg.” (1).</p></td>
</tr>
<tr class="row-odd"><td><p>MaxEnergy, MaxEnergy_RBV</p></td>
<td><p>ao, ai</p></td>
<td><p>DanteMaxEnergy</p></td>
<td><p>The actual energy of the last channel.  The user must provide this value based on the energy calibration.
It is used to provide meaningful units for FastThreshold, EnergyThreshold, and BaselineThreshold.</p></td>
</tr>
<tr class="row-even"><td><p>AnalogOffset, AnalogOffset_RBV</p></td>
<td><p>longout, longin</p></td>
<td><p>DanteAnalogOffset</p></td>
<td><p>The analog offset applied to the input signal, 0 to 255.
This offset must be adjusted to keep the input signal within the range of the ADC.
This should be adjusted using the ADC Trace plot with a long sampling to see the range of the input
signal through a reset event.</p></td>
</tr>
<tr class="row-odd"><td><p>ResetThreshold, ResetThreshold_RBV</p></td>
<td><p>longout, longin</p></td>
<td><p>DanteResetThreshold</p></td>
<td><p>The reset threshold in ADC units per N 8 ns sample intervals. The Dante detects a reset the signal changes by more than this amount.
The standard firmware uses N=6 and this ResetThreshold value.
The high-rate firmware uses N=1 and fixes ResetThreshold=256, so this parameter has no effect.</p></td>
</tr>
<tr class="row-even"><td><p>ResetRecoveryTime, ResetRecoveryTime_RBV</p></td>
<td><p>ao, ai</p></td>
<td><p>DanteResetRecoveryTime</p></td>
<td><p>The time in microseconds to wait after a reset event.</p></td>
</tr>
<tr class="row-odd"><td><p>Gain, Gain_RBV</p></td>
<td><p>ao, ai</p></td>
<td><p>DanteGain</p></td>
<td><p>The gain which controls the number of ADC units per MCA bin.  Gains of 1.0-8.0 are typical.</p></td>
</tr>
<tr class="row-even"><td><p>FastThreshold, FastThreshold_RBV</p></td>
<td><p>ao, ai</p></td>
<td><p>DanteFastFilterThreshold</p></td>
<td><p>The fast filter threshold in keV.</p></td>
</tr>
<tr class="row-odd"><td><p>FastPeakingTime, FastPeakingTime_RBV</p></td>
<td><p>ao, ai</p></td>
<td><p>DanteEdgePeakingTime</p></td>
<td><p>The peaking time of the fast filter in microseconds.</p></td>
</tr>
<tr class="row-even"><td><p>FastFlatTopTime, FastFlatTopTime_RBV</p></td>
<td><p>ao, ai</p></td>
<td><p>DanteEdgeFlatTop</p></td>
<td><p>The flat top time of the fast filter in microseconds.</p></td>
</tr>
<tr class="row-odd"><td><p>EnergyThreshold, EnergyThreshold_RBV</p></td>
<td><p>ao, ai</p></td>
<td><p>DanteEnergyFilterThreshold</p></td>
<td><p>The energy filter threshold in keV.</p></td>
</tr>
<tr class="row-even"><td><p>PeakingTime, PeakingTime_RBV</p></td>
<td><p>ao, ai</p></td>
<td><p>DantePeakingTime</p></td>
<td><p>The peaking time of the slow filter in microseconds.</p></td>
</tr>
<tr class="row-odd"><td><p>MaxPeakingTime, MaxPeakingTime_RBV</p></td>
<td><p>ao, ai</p></td>
<td><p>DanteMaxPeakingTime</p></td>
<td><p>The maximum peaking time of the slow filter in microseconds. Used only with the high-rate firmware.
Must be set to 0 when using the standard firmware.</p></td>
</tr>
<tr class="row-even"><td><p>FlatTopTime, FlatTopTime_RBV</p></td>
<td><p>ao, ai</p></td>
<td><p>DanteFlatTop</p></td>
<td><p>The flat top time of the slow filter in microseconds.</p></td>
</tr>
<tr class="row-odd"><td><p>BaselineThreshold, BaselineThreshold_RBV</p></td>
<td><p>ao, ai</p></td>
<td><p>DanteEnergyBaselineThreshold</p></td>
<td><p>The baseline filter threshold in keV.</p></td>
</tr>
<tr class="row-even"><td><p>MaxRiseTime, MaxRiseTime_RBV</p></td>
<td><p>ao, ai</p></td>
<td><p>DanteMaxRiseTime</p></td>
<td><p>The maximum rise time in usec. Pulses with a longer rise time will be pileup rejected.</p></td>
</tr>
<tr class="row-odd"><td><p>ZeroPeakFreq, ZeroPeakFreq_RBV</p></td>
<td><p>ao, ai</p></td>
<td><p>DanteZeroPeakFreq</p></td>
<td><p>The frequency of the zero-energy peak in Hz.</p></td>
</tr>
<tr class="row-even"><td><p>BaselineSamples, BaselineSamples_RBV</p></td>
<td><p>longout, longin</p></td>
<td><p>DanteBaselineSamples</p></td>
<td><p>The number of baseline samples.  Typical value is 64.</p></td>
</tr>
<tr class="row-odd"><td><p>TimeConstant, TimeConstant_RBV</p></td>
<td><p>ao, ai</p></td>
<td><p>DanteTimeConstant</p></td>
<td><p>The time constant. Used for digital deconvolution in the case of continuous reset signals.</p></td>
</tr>
<tr class="row-even"><td><p>BaseOffset, BaseOffset_RBV</p></td>
<td><p>longout, longin</p></td>
<td><p>DanteBaseOffset</p></td>
<td><p>The base offset. Used for digital deconvolution in the case of continuous reset signals.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="run-time-statistics">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Run-time statistics</a><a class="headerlink" href="#run-time-statistics" title="Permalink to this heading">¶</a></h2>
<p>These are the records for run-time statistics.</p>
<p>These parameters are specific to a single board, and are contained in DanteN.template.</p>
<table class="table-bordered table-striped table-hover docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>EPICS record names</p></th>
<th class="head"><p>Record types</p></th>
<th class="head"><p>drvInfo string</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ElapsedRealTime</p></td>
<td><p>ai</p></td>
<td><p>MCA_ELAPSED_REAL</p></td>
<td><p>The elapsed real time in seconds.</p></td>
</tr>
<tr class="row-odd"><td><p>ElapsedLiveTime</p></td>
<td><p>ai</p></td>
<td><p>MCA_ELAPSED_LIVE</p></td>
<td><p>The elapsed live time in seconds.</p></td>
</tr>
<tr class="row-even"><td><p>InputCountRate</p></td>
<td><p>ai</p></td>
<td><p>DanteInputCountRate</p></td>
<td><p>The input count rate in kHz.</p></td>
</tr>
<tr class="row-odd"><td><p>OutputCountRate</p></td>
<td><p>ai</p></td>
<td><p>DanteOutputCountRate</p></td>
<td><p>The output count rate in kHz.</p></td>
</tr>
<tr class="row-even"><td><p>Triggers</p></td>
<td><p>longin</p></td>
<td><p>DanteTriggers</p></td>
<td><p>The number of triggers received.</p></td>
</tr>
<tr class="row-odd"><td><p>Events</p></td>
<td><p>longin</p></td>
<td><p>DanteEvents</p></td>
<td><p>The number of events received.</p></td>
</tr>
<tr class="row-even"><td><p>FastDeadTime</p></td>
<td><p>longin</p></td>
<td><p>DanteEdgeDTime</p></td>
<td><p>The fast deadtime in clock ticks.</p></td>
</tr>
<tr class="row-odd"><td><p>F1DeadTime</p></td>
<td><p>longin</p></td>
<td><p>DanteFilt1DT</p></td>
<td><p>The filter 1 deadtime in clock ticks.</p></td>
</tr>
<tr class="row-even"><td><p>ZeroCounts</p></td>
<td><p>longin</p></td>
<td><p>DanteZeroCounts</p></td>
<td><p>The number of zero count events.</p></td>
</tr>
<tr class="row-odd"><td><p>BaselineCount</p></td>
<td><p>longin</p></td>
<td><p>DanteBaselinesValue</p></td>
<td><p>The number of baseline events.</p></td>
</tr>
<tr class="row-even"><td><p>PileUp</p></td>
<td><p>longin</p></td>
<td><p>DantePUPValue</p></td>
<td><p>The number of pileup events.</p></td>
</tr>
<tr class="row-odd"><td><p>F1PileUp</p></td>
<td><p>longin</p></td>
<td><p>DantePUPF1Value</p></td>
<td><p>The number of filter 1 pileup events.</p></td>
</tr>
<tr class="row-even"><td><p>NotF1PileUp</p></td>
<td><p>longin</p></td>
<td><p>DantePUPNotF1Value</p></td>
<td><p>The number of not filter 1 pileup events.</p></td>
</tr>
<tr class="row-odd"><td><p>ResetCounts</p></td>
<td><p>longin</p></td>
<td><p>DanteResetCounterValue</p></td>
<td><p>The number of reset events.</p></td>
</tr>
<tr class="row-even"><td><p>LastTimeStamp</p></td>
<td><p>ai</p></td>
<td><p>DanteLastTimeStamp</p></td>
<td><p>The last timestamp time in clock ticks.</p></td>
</tr>
</tbody>
</table>
<p>The following is the main MEDM screen dante1.adl. This screen is used with the single-channel Dante1.</p>
<figure class="align-center">
<img alt="_images/dante1.png" src="_images/dante1.png" />
</figure>
<p>The following is the main MEDM screen dante8.adl. This screen is used with the 8-channel Dante8.</p>
<figure class="align-center">
<img alt="_images/dante8.png" src="_images/dante8.png" />
</figure>
</section>
<section id="multi-element-systems">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Multi-element systems</a><a class="headerlink" href="#multi-element-systems" title="Permalink to this heading">¶</a></h2>
<p>Multi-element detector (MED) systems use an EPICS State Notation Language (SNL) program to synchronize and copy PVs.</p>
<p>These are the records for multi-element detector systems. They are contained in danteMED.template.</p>
<table class="table-bordered table-striped table-hover docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>EPICS record names</p></th>
<th class="head"><p>Record type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SNLConnected</p></td>
<td><p>bi</p></td>
<td><p>Indicates whether or not the SNL program is running.</p></td>
</tr>
<tr class="row-odd"><td><p>DeadTime</p></td>
<td><p>ai</p></td>
<td><p>The average deadtime of all the enabled boards.</p></td>
</tr>
<tr class="row-even"><td><p>IDeadTime</p></td>
<td><p>ai</p></td>
<td><p>The average instantaneous deadtime of all the enabled boards.</p></td>
</tr>
<tr class="row-odd"><td><p>Copy[XXX]</p></td>
<td><p>bo</p></td>
<td><p>Copies the setting XXX from board 0 to all other enabled boards.
XXX can be any of the configuration parameters described above,
for example Gain, AnalogOffset, etc.
XXX can also be the definition of the ROIs for the MCA records.
In this case the copy can be either by MCA channel number, or by x-ray energy,
using the calibration coefficients in the MCA record.</p></td>
</tr>
</tbody>
</table>
<p>The following is the MEDM screen dante8Parameters.adl. This screen is used with the Dante8.</p>
<figure class="align-center">
<img alt="_images/dante8Parameters.png" src="_images/dante8Parameters.png" />
</figure>
<p>The following is the MEDM screen dante8MCA.adl. This screen is used with the Dante8.</p>
<figure class="align-center">
<img alt="_images/dante8MCA.png" src="_images/dante8MCA.png" />
</figure>
<p>The following is the MEDM screen dante8Statistics.adl. This screen is used with the Dante8.</p>
<figure class="align-center">
<img alt="_images/dante8Statistics.png" src="_images/dante8Statistics.png" />
</figure>
<p>The following is the MEDM screen dante8ROI.adl. This screen is used with the Dante8.
It allows copying the definition of 16 ROIs from board 0 to all boards.</p>
<figure class="align-center">
<img alt="_images/dante8ROI.png" src="_images/dante8ROI.png" />
</figure>
</section>
<section id="mca-mode">
<h2><a class="toc-backref" href="#id10" role="doc-backlink">MCA mode</a><a class="headerlink" href="#mca-mode" title="Permalink to this heading">¶</a></h2>
<p>The MCA mode collects a single MCA record at a time.  It is compatible with the MCA record, and is the same
as MCA operation on many other EPICS MCAs, e.g. Canberra AIM, Amptek, XIA (Saturn, Mercury, xMAP, FalconX), SIS38XX, and others.</p>
<p>It only supports counting for a preset real time, or counting indefinitely (PresetReal=0).
It does not support PresetLive or PresetCounts which some other MCAs do.</p>
<p>The following is the MEDM screen mca.adl displaying the MCA spectrum as it is acquiring.</p>
<figure class="align-center">
<img alt="_images/dante_mca.png" src="_images/dante_mca.png" />
</figure>
<p>The following is the IDL MCA Display program showing the MCA spectrum as it is acquiring. This GUI allows defining ROIs
graphically, fitting peaks and background, and many other features.</p>
<figure class="align-center">
<img alt="_images/dante_idl_mca.png" src="_images/dante_idl_mca.png" />
</figure>
</section>
<section id="mca-mapping-mode">
<h2><a class="toc-backref" href="#id11" role="doc-backlink">MCA mapping mode</a><a class="headerlink" href="#mca-mapping-mode" title="Permalink to this heading">¶</a></h2>
<p>These are the records for MCA Mapping mode.  They are contained in dante.template.</p>
<table class="table-bordered table-striped table-hover docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>EPICS record names</p></th>
<th class="head"><p>Record types</p></th>
<th class="head"><p>drvInfo string</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CurrentPixel</p></td>
<td><p>longin</p></td>
<td><p>DanteCurrentPixel</p></td>
<td><p>In MCA Mapping mode this is the current pixel number.  In List mode it is the total number of x-ray events received so far.</p></td>
</tr>
<tr class="row-odd"><td><p>MappingPoints, MappingPoints_RBV</p></td>
<td><p>longout, longin</p></td>
<td><p>DanteMappingPoints</p></td>
<td><p>The number of spectra to collect in MCA mapping mode.</p></td>
</tr>
</tbody>
</table>
<p>In MCA mapping mode the GatingMode can be “Free running”, “Trig rising”, “Trig falling”, or “Trig both”.
In free-running mode the Dante will begin the next spectrum when the PresetReal time has elapsed.
In triggered mode the Dante will begin the next spectrum when a trigger occurs
or when the PresetReal time has elapsed, whichever comes first.
To advance only on trigger events set the PresetReal time to a value larger than the maximum time between triggers.</p>
<p>The MCA spectra are copied into NDArrays of dimensions [NumMCAChannels, NumBoards]. For a 1-channel Dante
NumBoards is 1.  The run-time statistics for each spectrum are copied into NDAttributes attached to each
NDArray. The attribute names contain the board number, for example “RealTime_0”.</p>
<p>The NDArrays can be used by any of the standard areaDetector plugins.  For example, they can be streamed
to HDF5, netCDF, or TIFF files.</p>
<p>The following is the MEDM screen NDFileHDF5.adl when the Dante is saving MCA mapping data to an HDF5 file.</p>
<figure class="align-center">
<img alt="_images/dante_mapping_hdf5.png" src="_images/dante_mapping_hdf5.png" />
</figure>
</section>
<section id="list-mode">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">List mode</a><a class="headerlink" href="#list-mode" title="Permalink to this heading">¶</a></h2>
<p>These are the records for list mode.  They are contained in dante.template.</p>
<table class="table-bordered table-striped table-hover docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>EPICS record names</p></th>
<th class="head"><p>Record types</p></th>
<th class="head"><p>drvInfo string</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CurrentPixel</p></td>
<td><p>longin</p></td>
<td><p>DanteCurrentPixel</p></td>
<td><p>In List mode this is the total number of x-ray events received so far.</p></td>
</tr>
<tr class="row-odd"><td><p>ListBufferSize, ListBufferSize_RBV</p></td>
<td><p>longout, longin</p></td>
<td><p>DanteListBufferSize</p></td>
<td><p>The number of x-ray events per buffer in list mode.
Once this number of events has been received the events read from the Dante
stored in NDArrays, and callbacks are done to any registered plugins.</p></td>
</tr>
</tbody>
</table>
<p>List mode events are 64-bit unsigned integers.</p>
<ul class="simple">
<li><p>Bits 0 to 15 are the x-ray energy, i.e. ADC value.</p></li>
<li><p>Bits 16 to 17 are not used.</p></li>
<li><p>Bits 18 to 61 are the timestamp in 8 ns units.</p></li>
<li><p>Bits 62 and 63 are not used.</p></li>
</ul>
<p>In list mode the x-ray events are copied into NDArrays.
The data type of the NDArrays is NDUInt64, and the NDArrayDimensions are [ListBufferSize, NumBoards].
For a 1-channel Dante NumBoards is 1.</p>
<p>The run-time statistics for ListBufferSize events are copied into NDAttributes attached to each
NDArray. The attribute names contain the board number, for example “RealTime_0”.
Note that these statistics are cummulative for the entire acquisition, not just since the
last time the event buffer was read.
By making ListBufferSize smaller one obtains a more frequent sampling of these statistics.</p>
<p>These statistics also update the run-time statistics records described above, so there is feedback
while the list mode acquisition is in progress.</p>
<p>The first NumMCAChannels events are copied to the buffer for the MCA record for each board.
In this case the MCA record will not contain an x-ray spectrum, but rather will contain the x-ray
energy in ADC units on the vertical axis and the event number on the horizontal axis.</p>
<p>The NDArrays can be used by most of the standard areaDetector plugins.  For example, they can be streamed
to HDF5 or TIFF files.  List-mode data cannot be written to a netCDF file, because the netCDF classic format
does not support 64-bit integer data types.</p>
<p>The following is an IDL procedure to read the List mode data from an HDF5 file into two arrays, “energy” and “time”:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pro read_dante_list_data, filename, energy, time
   data = read_nd_hdf5(filename)
   energy = uint(data and &#39;ffff&#39;x)
   time = double(ishft((data and &#39;3ffffffffffc0000&#39;x), -18))*8e-9
end
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/CARS-UChicago/IDL_Detectors/blob/master/read_nd_hdf5.pro">read_nd_hdf5</a> is a function that reads an HDF5 file written by the areaDetector NDFileHDF5 plugin:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>function read_nd_hdf5, file, range=range, dataset=dataset
  if (n_elements(dataset) eq 0) then dataset = &#39;/entry/data/data&#39;
  file_id = h5f_open(file)
  dataset_id = h5d_open(file_id, dataset)
  data = h5d_read(dataset_id)
  h5d_close, dataset_id
  h5f_close, file_id
  return, data
end
</pre></div>
</div>
<p>The following is a plot of the energy events for the first 1 second of that data, using this IDL command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>IDL&gt; p = plot(time, energy, xrange=[0,1], yrange=[0,20000], linestyle=&#39;none&#39;, symbol=&#39;plus&#39;)
</pre></div>
</div>
<figure class="align-center">
<img alt="_images/dante_idl_list_plot.png" src="_images/dante_idl_list_plot.png" />
</figure>
</section>
<section id="adc-trace-waveforms">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">ADC trace waveforms</a><a class="headerlink" href="#adc-trace-waveforms" title="Permalink to this heading">¶</a></h2>
<p>The Dante can collect ADC trace waveforms, which is effectively a digital oscilloscope of the pre-amp input signal.
This very useful for setting the AnalogOffset record, and for diagnosing issues with the input.</p>
<p>These are the records to control ADC traces. All of the records except TraceData affect all boards and are in dante.template.
TraceData is specific to each board and is in danteN.template.</p>
<table class="table-bordered table-striped table-hover docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>EPICS record names</p></th>
<th class="head"><p>Record types</p></th>
<th class="head"><p>drvInfo string</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ReadTrace</p></td>
<td><p>bo</p></td>
<td><p>DanteReadTrace</p></td>
<td><p>Arms the system to capture trace data on the next trigger event.</p></td>
</tr>
<tr class="row-odd"><td><p>TraceTimeArray</p></td>
<td><p>waveform</p></td>
<td><p>DanteTraceTimeArray</p></td>
<td><p>Waveform record containing the time values for each point in TraceData. 64-bit float data type.</p></td>
</tr>
<tr class="row-even"><td><p>TraceTime, TraceTime_RBV</p></td>
<td><p>ao, ai</p></td>
<td><p>DanteTraceTime</p></td>
<td><p>Time per sample of the ADC trace data in microseconds. Allowed range is 0.016 to 0.512.</p></td>
</tr>
<tr class="row-odd"><td><p>TraceLength, TraceLength_RBV</p></td>
<td><p>longout, longin</p></td>
<td><p>DanteTraceLength</p></td>
<td><p>The number of samples to read in the ADC trace.  This must be a multiple of 16384, and will be limited by the
NELM field of the TraceData and TraceTimeArray waveform records.</p></td>
</tr>
<tr class="row-even"><td><p>TraceTriggerLevel, TraceTriggerLevel_RBV</p></td>
<td><p>longout, longin</p></td>
<td><p>DanteTraceTriggerLevel</p></td>
<td><p>The trigger level in ADC units (0 to 65535).</p></td>
</tr>
<tr class="row-odd"><td><p>TraceTriggerRising, TraceTriggerRising_RBV</p></td>
<td><p>bo, bi</p></td>
<td><p>DanteTraceTriggerRising</p></td>
<td><p>Trigger the ADC trace as it rises through TraceTriggerLevel. Choices are “No” (0) and “Yes” (1).</p></td>
</tr>
<tr class="row-even"><td><p>TraceTriggerFalling, TraceTriggerFalling_RBV</p></td>
<td><p>bo, bi</p></td>
<td><p>DanteTraceTriggerFalling</p></td>
<td><p>Trigger the ADC trace as it fals through TraceTriggerLevel. Choices are “No” (0) and “Yes” (1).</p></td>
</tr>
<tr class="row-odd"><td><p>TraceTriggerInstant, TraceTriggerInstant_RBV</p></td>
<td><p>bo, bi</p></td>
<td><p>DanteTraceTriggerInstant</p></td>
<td><p>Trigger the ADC trace even if a rising or falling trigger is not detected. Choices are “No” (0) and “Yes” (1).</p></td>
</tr>
<tr class="row-even"><td><p>TraceTriggerWait, TraceTriggerWait_RBV</p></td>
<td><p>ao, ai</p></td>
<td><p>DanteTraceTriggerWait</p></td>
<td><p>The delay time after the trigger condition is satisfied before beginning the ADC trace.</p></td>
</tr>
<tr class="row-odd"><td><p>TraceData</p></td>
<td><p>waveform</p></td>
<td><p>DanteTraceData</p></td>
<td><p>Waveform record containing the ADC trace data. 32-bit integer data type.</p></td>
</tr>
</tbody>
</table>
<p>The following are the MEDM screen danteTrace.adl displaying two ADC traces. These were done with a Vortex SDD detctor and a Cd109 source,
which produces Ag K x-rays.  The traces were captured with TraceTriggerRising=Yes and TraceTriggerLevel=50000.
The first trace was done with TraceTime=0.512 microseconds, so the total time is 8192 microseconds. 2 resets are visible on this trace.
The second trace was done with TraceTime=0.016 microseconds, so the total time is 256 microseconds.  The individual 22 keV Ag x-ray steps
can be seen in this trace.</p>
<figure class="align-center">
<img alt="_images/dante_trace1.png" src="_images/dante_trace1.png" />
</figure>
<figure class="align-center">
<img alt="_images/dante_trace2.png" src="_images/dante_trace2.png" />
</figure>
<p>The following is the MEDM screen dante8Trace.adl. This screen is used with the Dante8.</p>
<figure class="align-center">
<img alt="_images/dante8Trace.png" src="_images/dante8Trace.png" />
</figure>
</section>
<section id="ioc-startup-script">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">IOC startup script</a><a class="headerlink" href="#ioc-startup-script" title="Permalink to this heading">¶</a></h2>
<p>The command to configure a Dante in the startup script is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>DanteConfig(portName, ipAddress, totalBoards, maxMemory)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">portName</span></code> is the name for the Dante port driver</p>
<p><code class="docutils literal notranslate"><span class="pre">ipAddress</span></code> is the IP address of the Dante</p>
<p><code class="docutils literal notranslate"><span class="pre">totalBoards</span></code> is the total number of boards in the Dante system, including those that may be disabled.</p>
<p><code class="docutils literal notranslate"><span class="pre">maxMemory</span></code> is the maximum amount of memory the NDArrayPool is allowed to allocate.  0 means unlimited.</p>
</section>
<section id="performance">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Performance</a><a class="headerlink" href="#performance" title="Permalink to this heading">¶</a></h2>
<section id="dante8-free-running-mapping-mode">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Dante8 free-running mapping mode</a><a class="headerlink" href="#dante8-free-running-mapping-mode" title="Permalink to this heading">¶</a></h3>
<p>The following table shows the maximum number of pixels/s for MCA mapping mode as a function of the number of boards enabled
and the number of MCA channels on the Dante8. The tests were done under the following conditions:</p>
<ul class="simple">
<li><p>MappingPoints = 2000</p></li>
<li><p>PollTime = 0.01</p></li>
<li><p>ArrayCallbacks = Enable</p></li>
<li><p>WaitForPlugins = Yes</p></li>
<li><p>TriggerMode = FreeRunning</p></li>
</ul>
<p>The PresetReal time was decreased in 1 ms steps until the mapping mode acquisition no longer collected the requested number of pixels.</p>
<p>The PresetReal time on the Dante is limited to multiples of 1 ms,
so the pixel rate in FreeRun mode is limited to 1000, 500, 333, 250, etc.</p>
<table class="table-bordered table-striped table-hover docutils align-default" id="id2">
<caption><span class="caption-text">Maximum pixel rate in Hz (spectra/board/second) for TriggerMode=FreeRunning</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>MCA Channels</p></th>
<th class="head"><p>1 board  enabled</p></th>
<th class="head"><p>2 boards enabled</p></th>
<th class="head"><p>4 boards enabled</p></th>
<th class="head"><p>8 boards enabled</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1024</p></td>
<td><p>1000</p></td>
<td><p>1000</p></td>
<td><p>1000</p></td>
<td><p>500</p></td>
</tr>
<tr class="row-odd"><td><p>2048</p></td>
<td><p>1000</p></td>
<td><p>1000</p></td>
<td><p>500</p></td>
<td><p>333</p></td>
</tr>
<tr class="row-even"><td><p>4096</p></td>
<td><p>1000</p></td>
<td><p>1000</p></td>
<td><p>1000</p></td>
<td><p>1000</p></td>
</tr>
</tbody>
</table>
</section>
<section id="dante8-externally-triggered-mapping-mode">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Dante8 externally triggered mapping mode</a><a class="headerlink" href="#dante8-externally-triggered-mapping-mode" title="Permalink to this heading">¶</a></h3>
<p>The following table shows the maximum number of pixels/s for MCA mapping mode as a function of the number of boards enabled
and the number of MCA channels on the Dante8. The tests were done under the following conditions:</p>
<ul class="simple">
<li><p>MappingPoints = 2000</p></li>
<li><p>PollTime = 0.01</p></li>
<li><p>ArrayCallbacks = Enable</p></li>
<li><p>WaitForPlugins = Yes</p></li>
<li><p>TriggerMode = Trig Rising</p></li>
<li><p>PresetReal = 0.1 (does not matter)</p></li>
</ul>
<p>The Dante8 was triggered by an external programmable pulse generator.  The pulse width was 10 microseconds.
The pulse generator was programmed to output 2000 pulses.</p>
<p>The pulse frequency was increased until the mapping mode acquisition no longer collected the requested number of pixels.</p>
<table class="table-bordered table-striped table-hover docutils align-default" id="id3">
<caption><span class="caption-text">Maximum pixel rate in Hz (spectra/board/second) for TriggerMode=Trig Rising</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>MCA Channels</p></th>
<th class="head"><p>1 board  enabled</p></th>
<th class="head"><p>2 boards enabled</p></th>
<th class="head"><p>4 boards enabled</p></th>
<th class="head"><p>8 boards enabled</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1024</p></td>
<td><p>6200</p></td>
<td><p>2300</p></td>
<td><p>900</p></td>
<td><p>350</p></td>
</tr>
<tr class="row-odd"><td><p>2048</p></td>
<td><p>1500</p></td>
<td><p>750</p></td>
<td><p>340</p></td>
<td><p>150</p></td>
</tr>
<tr class="row-even"><td><p>4096</p></td>
<td><p>8060</p></td>
<td><p>8060</p></td>
<td><p>8060</p></td>
<td><p>8060</p></td>
</tr>
</tbody>
</table>
<p>The same results as above were obtained for TriggerMode=Gate High.</p>
<p>In 4096 channel mode all spectra are eventually collected for trigger frequencies up to 8000 Hz.
However, in 2048 and 1024 channel mode the maximum trigger frequency is much less before spectra are lost,
and the EPICS IOC needs to be restarted.</p>
</section>
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019, Mark Rivers.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br/>
    </p>
  </div>
</footer>
  </body>
</html>